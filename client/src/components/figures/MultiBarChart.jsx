import React, { useMemo, useState } from "react";
import { Card, Form, Container, Row, Col } from "react-bootstrap";
import {
  BarChart as RechartsBarChart,
  Bar,
  XAxis,
  YAxis,
  Tooltip,
  CartesianGrid,
  ResponsiveContainer,
} from "recharts"; // Import Recharts components

// Define a set of colors for the bars
const barColors = [
  "#8884d8", // Purple
  "#82ca9d", // Light Green
  "#ffc658", // Yellow
  "#ff8042", // Orange
  "#00C49F", // Teal
  "#0088FE", // Blue
];

// Function to map the data for the chart
const mapData = (data, metricType) => {
  const result = [];

  if (data && typeof data === "object" && Object.keys(data).length > 0) {
    Object.entries(data)?.forEach(([key, obj]) => {
      const item = { label: key };

      Object.entries(obj)?.forEach(([k, metrics]) => {
        item[k] = metrics[metricType];
      });

      result.push(item);
    });
  }

  return result;
};

export default function MultiBarChart({ label, data, loading }) {
  const [metricType, setMetricType] = useState("accuracy");

  const result = useMemo(
    () => mapData(data, metricType),
    [Object.keys(data).length, metricType]
  );

  return (
    <Card
      className="p-3 mb-4 shadow-sm"
      style={{
        backgroundColor: "#333", // Dark background for the card
        color: "white", // White text color
        border: "none", // No border
      }}
    >
      <Container>
        <Card.Title
          className="font-weight-bold"
          style={{ marginBottom: "20px", color: "white" }}
        >
          {label}
        </Card.Title>
        <Row>
          <Col xs="auto">
            <Form.Group controlId="metricTypeSelect">
              <Form.Label style={{ color: "white" }}> Metric Type </Form.Label>
              <Form.Control
                style={{
                  marginLeft: "10px",
                  padding: "5px",
                  backgroundColor: "#555", // Dark background for the select
                  color: "white", // White text for the select
                  border: "none", // No border
                }}
                as="select"
                value={metricType}
                onChange={(event) => setMetricType(event.target.value)}
              >
                <option value="accuracy">Accuracy</option>
                <option value="precision">Precision</option>
                <option value="recall">Recall</option>
                <option value="f1-score">F1 Score</option>
              </Form.Control>
            </Form.Group>
          </Col>
        </Row>
      </Container>

      {loading ? (
        <p style={{ color: "white" }}>Loading...</p> // Loading text in white
      ) : (
        <ResponsiveContainer width="100%" height={400}>
          <RechartsBarChart
            data={result}
            margin={{ top: 20, right: 30, left: 20, bottom: 5 }}
          >
            <CartesianGrid strokeDasharray="3 3" stroke="#555" />{" "}
            {/* Darker grid lines */}
            <XAxis dataKey="label" stroke="white" />{" "}
            {/* X-axis labels in white */}
            <YAxis stroke="white" /> {/* Y-axis in white */}
            <Tooltip
              contentStyle={{ backgroundColor: "#555", color: "white" }}
            />{" "}
            {/* Tooltip in dark theme */}
            {Object.keys(result[0] || {}).map((key, index) => (
              <Bar
                key={`${key}-index`}
                dataKey={key} // Each bar is grouped by model
                fill={barColors[index % barColors.length]} // Assign different colors to each bar
              />
            ))}
          </RechartsBarChart>
        </ResponsiveContainer>
      )}
    </Card>
  );
}
